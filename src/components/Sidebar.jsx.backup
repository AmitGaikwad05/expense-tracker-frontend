import { NavLink } from "react-router-dom"
import { logoutUser } from "../store/authSlice";
import { useDispatch } from "react-redux";
import { useEffect, useState } from "react";

const Sidebar = ({user}) => {
const dispatch = useDispatch();
const [isOpen, setIsOpen] = useState(false);

  //  -------------- Handling logout ---------------
  const handleLogout = () => {
    dispatch(logoutUser());
  };

  useEffect(() => {
    const handler = () => setIsOpen(prev => !prev);
    window.addEventListener("toggleSidebar", handler);
    return () => window.removeEventListener("toggleSidebar", handler);
  }, []);

  return (
<>
  {/* Mobile backdrop */}
  <div
    onClick={() => setIsOpen(false)}
    className={`fixed inset-0 bg-black/30 z-30 md:hidden transition-opacity duration-300 ${isOpen ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'}`}
  />

  <div className={`fixed md:static inset-y-0 left-0 z-40 w-64 md:w-52 bg-gray-200 min-h-screen p-2 pt-20 transform transition-transform duration-300 ease-in-out
    ${isOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0`}>

  <div className="md:fixed">

  <h2 className="font-semibold text-2xl wrap-normal text-green-700 mb-4" >{user.name}</h2>

  <div className="flex flex-col  p-1 w-full *:bg-white gap-4 *:rounded-2xl  *:p-2 *:hover:bg-green-100">
      <NavLink to="/dashboard" 
      className={({isActive})=> `${ isActive?"active-link" : "" }` }
      >Dashboard</NavLink>
      <NavLink to="/userprofile"
      className={({isActive})=> `${ isActive?"active-link" : "" }`}
      >User Profile</NavLink>
      <NavLink to="/earnings" 
      className={({isActive})=> `${ isActive?"active-link" : "" }`}
      >Earnings</NavLink>
      <NavLink to="/expenses" 
      className={({isActive})=> `${ isActive?"active-link" : "" }`}
      >Expenses</NavLink>
  </div>
      <button className="bg-red-300 text-red-800 px-3  w-full rounded hover:cursor-pointer hover:bg-red-400 transition mt-10" onClick={handleLogout} >Logout</button>

  </div>

  </div>
</>
  )
}

export default Sidebar